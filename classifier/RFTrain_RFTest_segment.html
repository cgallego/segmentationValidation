<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta http-equiv="x-ua-compatible" content="IE=9" >

<title>Testing segmentation with forest classifier: Design one-shot</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h1>Testing segmentation with forest classifier: Design one-shot</h1>

<p>First train RF with (casesID=c(1:410), total=410)</p>

<pre><code class="r">trainRFoneshot &lt;- function(){
    library(caret)
    library(randomForest)
    library(MASS)
    library(mlbench)
    library(pROC)

    library(&quot;RSQLite&quot;)
    sqlite &lt;- dbDriver(&quot;SQLite&quot;)
    conn &lt;- dbConnect(sqlite, &quot;localData.db&quot;)

    # 2) all T1W features
    lesionsQuery &lt;- dbGetQuery(conn, &quot;SELECT *
                            FROM  lesion
                            INNER JOIN f_dynamic ON (lesion.lesion_id = f_dynamic.lesion_id)
                            INNER JOIN f_morphology ON (lesion.lesion_id = f_morphology.lesion_id)
                            INNER JOIN f_texture ON (lesion.lesion_id = f_texture.lesion_id)&quot;)

    # prune entries and extract feature subsets
    # corresponds to 5 entries lesion info, 34 dynamic, 19 morpho, 34 texture fueatures
    lesionsfields = names(lesionsQuery[c(1,23,24,3,5,27:60,63:81,84:107)])
    lesioninfoTrain = lesionsQuery[c(1,23,24,3,5)]
    featuresTrain = lesionsQuery[c(1,23,27:60,63:81,84:107)]

    ########## ########## ########## ########## ########## 
    ### Select subsets of features correspondingly
    trainingset &lt;- featuresTrain[c(2:79)]        
    C&lt;-subset(trainingset, lesion_label==&quot;massM&quot; | lesion_label==&quot;nonmassM&quot;)
    ifelse( C$lesion_label == &quot;massM&quot;, &quot;C&quot;, &quot;C&quot;) -&gt; C$lesion_label
    NC&lt;-subset(trainingset, lesion_label==&quot;massB&quot; | lesion_label==&quot;nonmassB&quot;)
    ifelse( NC$lesion_label == &quot;massB&quot;, &quot;NC&quot;, &quot;NC&quot;) -&gt; NC$lesion_label

    trainingset = data.frame(rbind(C,NC))

    ########## ########## ########## ########## ########## 
    ## 3) For each resampling two AUC ROC curves are constructed for the two feature sets to be compared
    bootControl &lt;- trainControl(method = &quot;boot&quot;, 
                                number = 10, # number of boostrap iterations
                                savePredictions = TRUE,
                                p = 0.75,
                                classProbs = TRUE,
                                returnResamp = &quot;all&quot;,
                                verbose = FALSE,
                                summaryFunction = twoClassSummary)
    #OUTPUT
    ########## RF 1
    RFGrid &lt;- expand.grid( .mtry=c(1:5) )
    set.seed(10112014)
    set4_RFfit &lt;- train(as.factor(lesion_label) ~ ., data = trainingset,
                        method = &quot;rf&quot;,
                        trControl = bootControl,
                        tuneGrid = RFGrid,
                        returnData = TRUE,
                        fitBest = TRUE,
                        verbose=FALSE,
                        metric=&quot;ROC&quot;)
    print(set4_RFfit)
    print(set4_RFfit$finalModel)

    output&lt;-list(set4_RFfit=set4_RFfit, lesioninfoTrain=lesioninfoTrain, featuresTrain=featuresTrain)

    return(output)
}
</code></pre>

<p>Now test on independent test set </p>

<pre><code class="r">testRFoneshot &lt;- function(set4_RFfit) {
    library(&quot;RSQLite&quot;)
    sqlite &lt;- dbDriver(&quot;SQLite&quot;)
    conn &lt;- dbConnect(sqlite, &quot;HongboDatabase.db&quot;)

    # 2) all T1W features
    lesionsQuery &lt;- dbGetQuery(conn, &quot;SELECT *\n                            FROM  lesion\n                            INNER JOIN f_dynamic ON (lesion.lesion_id = f_dynamic.lesion_id)\n                            INNER JOIN f_morphology ON (lesion.lesion_id = f_morphology.lesion_id)\n                            INNER JOIN f_texture ON (lesion.lesion_id = f_texture.lesion_id)&quot;)

    # prune entries and extract feature subsets corresponds to 5 entries
    # lesion info, 34 dynamic, 19 morpho, 34 texture fueatures
    lesionsfields = names(lesionsQuery[c(1, 23, 24, 3, 5, 27:60, 63:81, 84:107)])
    lesioninfoTest = lesionsQuery[c(1, 23, 24, 3, 5)]
    featuresTest = lesionsQuery[c(1, 23, 27:60, 63:81, 84:107)]

    ########## ########## ########## ########## ########## Select subsets of
    ########## features correspondingly
    originaltestingset = featuresTest
    testingset &lt;- featuresTest[c(2:79)]
    C &lt;- subset(testingset, lesion_label == &quot;massM&quot; | lesion_label == &quot;nonmassM&quot;)
    C$lesion_label &lt;- ifelse(C$lesion_label == &quot;massM&quot;, &quot;C&quot;, &quot;C&quot;)
    NC &lt;- subset(testingset, lesion_label == &quot;massB&quot; | lesion_label == &quot;nonmassB&quot;)
    NC$lesion_label &lt;- ifelse(NC$lesion_label == &quot;massB&quot;, &quot;NC&quot;, &quot;NC&quot;)

    testingset = data.frame(rbind(C, NC))

    # Record new predictions
    # 

    RFmodel &lt;- list(RFmodel = set4_RFfit)
    probValues &lt;- extractProb(RFmodel, testX = testingset[, 2:78], testY = testingset[, 
        1])
    k_probValues &lt;- subset(probValues, dataType == &quot;Test&quot;)

    casestest = data.frame(lesion_id = originaltestingset[, 1], lesion_label = originaltestingset[, 
        2])
    casestest$pred = k_probValues$pred
    casestest$obs = k_probValues$obs
    casestest$P = k_probValues$C
    casestest$N = k_probValues$NC

    ############# PLOT
    RFmodel_ROC &lt;- plot.roc(casestest$obs, casestest$P, main = &quot;Classifier performance on test cases&quot;, 
        percent = TRUE, col = &quot;#860000&quot;, ci = FALSE, of = &quot;se&quot;, smooth.method = &quot;binormal&quot;, 
        sp = seq(0, 100, 10))
    print(RFmodel_ROC)
    legend(&quot;bottomright&quot;, legend = c(&quot;RFmodel&quot;), col = c(&quot;#860000&quot;), lwd = 2, 
        lty = c(1))

    output &lt;- list(casestest = casestest, lesioninfoTest = lesioninfoTest)

    return(output)
}
</code></pre>

<h1>Train </h1>

<pre><code class="r">setwd(&quot;Z:/Cristina/SharePoint/segmentationValidation/classifier&quot;)
RFoneshot &lt;- trainRFoneshot()
</code></pre>

<pre><code>## Loading required package: cluster
## Loading required package: foreach
## Loading required package: lattice
## Loading required package: plyr
## Loading required package: reshape2
## randomForest 4.6-7
## Type rfNews() to see new features/changes/bug fixes.
## Type &#39;citation(&quot;pROC&quot;)&#39; for a citation.
## 
## Attaching package: &#39;pROC&#39;
## 
## The following object(s) are masked from &#39;package:stats&#39;:
## 
##     cov, smooth, var
## 
## Loading required package: DBI
</code></pre>

<pre><code>## Warning: executing %dopar% sequentially: no parallel backend registered
</code></pre>

<pre><code>## 410 samples
##  77 predictors
##   2 classes: &#39;C&#39;, &#39;NC&#39; 
## 
## No pre-processing
## Resampling: Bootstrap (10 reps) 
## 
## Summary of sample sizes: 410, 410, 410, 410, 410, 410, ... 
## 
## Resampling results across tuning parameters:
## 
##   mtry  ROC  Sens  Spec  ROC SD  Sens SD  Spec SD
##   1     0.8  0.7   0.7   0.03    0.06     0.05   
##   2     0.8  0.7   0.7   0.03    0.05     0.05   
##   3     0.8  0.7   0.7   0.03    0.06     0.04   
##   4     0.8  0.7   0.7   0.03    0.05     0.04   
##   5     0.8  0.7   0.7   0.03    0.05     0.05   
## 
## ROC was used to select the optimal model using  the largest value.
## The final value used for the model was mtry = 3. 
## 
## Call:
##  randomForest(x = trainX, y = trainY, mtry = tuneValue$.mtry,      returnData = TRUE, fitBest = TRUE, verbose = FALSE) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 3
## 
##         OOB estimate of  error rate: 29.02%
## Confusion matrix:
##      C  NC class.error
## C  151  58      0.2775
## NC  61 140      0.3035
</code></pre>

<h1>Test</h1>

<pre><code class="r">casestest &lt;- testRFoneshot(RFoneshot$set4_RFfit)
</code></pre>

<pre><code>## Warning: &quot;of&quot; is not a graphical parameter
## Warning: &quot;sp&quot; is not a graphical parameter
## Warning: &quot;of&quot; is not a graphical parameter
## Warning: &quot;sp&quot; is not a graphical parameter
</code></pre>

<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAfgAAAH4CAMAAACR9g9NAAAArlBMVEX///8AAAAAADkAAGMAOTkAOWMAOYwAY4wAY7U5AAA5ADk5AGM5OWM5OYw5Y2M5Y7U5jNZjAABjADljAGNjOQBjOYxjYwBjYzljY2NjY7Vjtf+EAACMOQCMOTmMOWOMYwCMjDmMjGOMtYyM1rWM1taM1v+tra21YwC1Yzm1Y2O1tWO11oy1/7W1/9a1///WjDnWtWPW1ozW/7XW/9bW////tWP/1oz//7X//9b///9V9spQAAAAOnRSTlP///////////////////////////////////////////////////////////////////////////8AN8D/CgAAAAlwSFlzAAALEgAACxIB0t1+/AAAEqNJREFUeJzt3Q1/6rYVx/E5WTPY3d0g6V03yu3WdVzWroO1C0/v/41Nkm2wwWDLOpKOdP6/TzcSAoLLN/JDMPCbExLZb2LfARQnwAsN8EIDvNAALzTACw3wQgO80AAvNMALjRP8YV4UxUyfPm/uX0b9bD8tnn54cKGu9HVW7vexu/Vi+LlMYgS/K0yTh/CmdWH/kI65jtvYPm/RPT7wx6We7Vs1Lw28/jXQU1TN1EL/HlSn6mf/Waofvfxqfju26suFvu7TN+WEPi6ffyqv0PqZ6eXdnDerL/998buluujWXKy6vcv11f1pjVN2HuB8M+aC6tf1fLnyntbnni4jXf+Trq4R9uHmA7+fKhj1IC3MjDeLfUV1e9qEXxvQWfnY66uXX5mvWz/76mtz5rpappSX/29Rd7m96vrVRYrGbZhaA1SwFXF9uWqk/y1bPy9u/0nX13gP+nDzgd/VD+55Ua9Py1+H+tei+pleiJ5/qCafnl7l5CqXG+qRXFz/TF9nP1UT7jB/WpXn7Qo9RLHQ59Rjm+vvlMJ+Wt7QeZzyXlwGKC9mbrQcu7pcfU/Pi/p6pM5/UusaIeMLr+dBNU3MIr4+bcBXWwXaod5wK4m2xez6Z/o6O/MrsC0W5Xm7anui/K68PfP1Yf7yXt+d8zjlN80B9MXMZcqxq8vV9/QM3/yHNf9Jt9cIGR/49qJer/bMo2G+UI9ydUoPrxfvT6v69sz1S/hyGXIPvrqYuUwL/nyPL/CT6h/Y/ifdXiNkfODV731j407RlctIXf0Q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" alt="plot of chunk unnamed-chunk-4"/> </p>

<pre><code>## 
## Call:
## plot.roc.default(x = casestest$obs, predictor = casestest$P,     main = &quot;Classifier performance on test cases&quot;, percent = TRUE,     col = &quot;#860000&quot;, ci = FALSE, of = &quot;se&quot;, smooth.method = &quot;binormal&quot;,     sp = seq(0, 100, 10))
## 
## Data: casestest$P in 19 controls (casestest$obs C) &gt; 21 cases (casestest$obs NC).
## Area under the curve: 87.5%
</code></pre>

<pre><code class="r">print(casestest)
</code></pre>

<pre><code>## $casestest
##    lesion_id lesion_label pred obs     P     N
## 1          1        massM   NC   C 0.476 0.524
## 2          2        massM   NC   C 0.404 0.596
## 3          3        massM    C   C 0.538 0.462
## 4          4        massM    C   C 0.634 0.366
## 5          5        massM    C   C 0.640 0.360
## 6          6        massM   NC   C 0.466 0.534
## 7          7        massM    C   C 0.834 0.166
## 8          8        massM    C   C 0.668 0.332
## 9          9        massM    C   C 0.664 0.336
## 10        10        massM    C   C 0.542 0.458
## 11        11        massM    C   C 0.634 0.366
## 12        12        massM    C   C 0.570 0.430
## 13        13        massM    C   C 0.572 0.428
## 14        14        massM   NC   C 0.412 0.588
## 15        15     nonmassM   NC   C 0.456 0.544
## 16        16     nonmassM   NC   C 0.420 0.580
## 17        17        massM    C   C 0.678 0.322
## 18        18        massM    C   C 0.624 0.376
## 19        19        massB    C   C 0.506 0.494
## 20        20        massB   NC  NC 0.370 0.630
## 21        21        massB   NC  NC 0.484 0.516
## 22        22        massB   NC  NC 0.276 0.724
## 23        23        massB   NC  NC 0.198 0.802
## 24        24        massB   NC  NC 0.196 0.804
## 25        25        massB   NC  NC 0.474 0.526
## 26        26        massB    C  NC 0.580 0.420
## 27        27        massB    C  NC 0.580 0.420
## 28        28        massB   NC  NC 0.376 0.624
## 29        29        massB   NC  NC 0.468 0.532
## 30        30        massB   NC  NC 0.470 0.530
## 31        31        massB   NC  NC 0.390 0.610
## 32        32        massB   NC  NC 0.392 0.608
## 33        33        massB    C  NC 0.510 0.490
## 34        34        massB   NC  NC 0.346 0.654
## 35        35        massB   NC  NC 0.192 0.808
## 36        36     nonmassB   NC  NC 0.238 0.762
## 37        37     nonmassB   NC  NC 0.330 0.670
## 38        38     nonmassB   NC  NC 0.224 0.776
## 39        39     nonmassB   NC  NC 0.358 0.642
## 40        40        massM   NC  NC 0.268 0.732
## 
## $lesioninfoTest
##    lesion_id lesion_label lesion_diagnosis cad_pt_no_txt exam_a_number_txt
## 1          1        massM        malignant           114             20136
## 2          2        massM        malignant          6044              7942
## 3          3        massM        malignant           687              1201
## 4          4        massM        malignant           714             12545
## 5          5        massM        malignant           714             12545
## 6          6        massM        malignant           730              6667
## 7          7        massM        malignant           735             11604
## 8          8        massM        malignant           776             13062
## 9          9        massM        malignant           776             13062
## 10        10        massM        malignant           781              2462
## 11        11        massM        malignant           812              1321
## 12        12        massM        malignant           815              3656
## 13        13        massM        malignant           829             11462
## 14        14        massM        malignant           830              4147
## 15        15     nonmassM        malignant           760              2288
## 16        16     nonmassM        malignant           807             11009
## 17        17        massM        malignant          6037              7300
## 18        18        massM        malignant           764              8458
## 19        19        massB           benign           198              5800
## 20        20        massB           benign           198              5800
## 21        21        massB           benign           331              4331
## 22        22        massB           benign           651              2290
## 23        23        massB           benign           663              3222
## 24        24        massB           benign           710             11884
## 25        25        massB           benign           710             11884
## 26        26        massB           benign           710             11884
## 27        27        massB           benign           839              4966
## 28        28        massB           benign           856              8280
## 29        29        massB           benign           731             11537
## 30        30        massB           benign           736              6041
## 31        31        massB           benign           758              3085
## 32        32        massB           benign           799             13427
## 33        33        massB           benign           839              4966
## 34        34        massB           benign           850             13610
## 35        35        massB           benign           856              8280
## 36        36     nonmassB           benign           707              9906
## 37        37     nonmassB           benign           752              5474
## 38        38     nonmassB           benign           796              8176
## 39        39     nonmassB           benign           850             13610
## 40        40        massM        malignant           687              1201
</code></pre>

<pre><code class="r"># decide with train
cad_pt_test = casestest$lesioninfoTest$cad_pt_no_txt

for (i in 1:length(cad_pt_test)) {
    cadpt = cad_pt_test[i]
    lencadpt = length(strsplit(cadpt, split = &quot;&quot;)[[1]])
    if (lencadpt == 2) {
        cadpt = paste0(&quot;00&quot;, cadpt)
    }
    if (lencadpt == 3) {
        cadpt = paste0(&quot;0&quot;, cadpt)
    }

    # find id by StudyId
    lesioninfoTrain = RFoneshot$lesioninfoTrain
    lesioninfoTrain[lesioninfoTrain$cad_pt_no_txt == cadpt, ]
    lesionidcatpt = lesioninfoTrain[lesioninfoTrain$cad_pt_no_txt == cadpt, 
        ]$lesion_id[1]

    # extract casetest features
    featuresTrain = RFoneshot$featuresTrain
    casetest = featuresTrain[featuresTrain$lesion_id == lesionidcatpt, ]
    if (casetest$lesion_label == &quot;massB&quot;) 
        casetest$lesion_label = &quot;NC&quot;
    if (casetest$lesion_label == &quot;massM&quot;) 
        casetest$lesion_label = &quot;C&quot;
    if (casetest$lesion_label == &quot;nonmassB&quot;) 
        casetest$lesion_label = &quot;NC&quot;
    if (casetest$lesion_label == &quot;nonmassM&quot;) 
        casetest$lesion_label = &quot;C&quot;

    # classify original
    RFmodel &lt;- list(RFmodel = RFoneshot$set4_RFfit)
    probValues &lt;- extractProb(RFmodel, testX = casetest[, 3:79], testY = casetest[, 
        2])
    k_probValues &lt;- subset(probValues, dataType == &quot;Test&quot;)

    dftrain = data.frame(featuresTrain[featuresTrain$lesion_id == lesionidcatpt, 
        1:2])
    dftrain$pred = k_probValues$pred
    dftrain$obs = k_probValues$obs
    dftrain$P1 = k_probValues$C
    dftrain$N1 = k_probValues$NC
    print(dftrain)
    # vs test
    print(casestest$casestest[i, ])
    print(&quot;======&quot;)

}
</code></pre>

<pre><code>##   lesion_id lesion_label pred obs    P1    N1
## 4         4        massM    C   C 0.862 0.138
##   lesion_id lesion_label pred obs     P     N
## 1         1        massM   NC   C 0.476 0.524
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 215       215        massB   NC  NC 0.048 0.952
##   lesion_id lesion_label pred obs     P     N
## 2         2        massM   NC   C 0.404 0.596
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 38        38        massM    C   C 0.832 0.168
##   lesion_id lesion_label pred obs     P     N
## 3         3        massM    C   C 0.538 0.462
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 56        56        massM    C   C 0.872 0.128
##   lesion_id lesion_label pred obs     P     N
## 4         4        massM    C   C 0.634 0.366
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 56        56        massM    C   C 0.872 0.128
##   lesion_id lesion_label pred obs    P    N
## 5         5        massM    C   C 0.64 0.36
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs   P1   N1
## 72        72        massM    C   C 0.84 0.16
##   lesion_id lesion_label pred obs     P     N
## 6         6        massM   NC   C 0.466 0.534
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 74        74        massM    C   C 0.988 0.012
##   lesion_id lesion_label pred obs     P     N
## 7         7        massM    C   C 0.834 0.166
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs   P1   N1
## 90        90        massB   NC  NC 0.18 0.82
##   lesion_id lesion_label pred obs     P     N
## 8         8        massM    C   C 0.668 0.332
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs   P1   N1
## 90        90        massB   NC  NC 0.18 0.82
##   lesion_id lesion_label pred obs     P     N
## 9         9        massM    C   C 0.664 0.336
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 95        95        massM    C   C 0.778 0.222
##    lesion_id lesion_label pred obs     P     N
## 10        10        massM    C   C 0.542 0.458
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 113       113        massM    C   C 0.952 0.048
##    lesion_id lesion_label pred obs     P     N
## 11        11        massM    C   C 0.634 0.366
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 116       116        massM    C   C 0.882 0.118
##    lesion_id lesion_label pred obs    P    N
## 12        12        massM    C   C 0.57 0.43
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 122       122        massM    C   C 0.792 0.208
##    lesion_id lesion_label pred obs     P     N
## 13        13        massM    C   C 0.572 0.428
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 123       123        massB   NC  NC 0.192 0.808
##    lesion_id lesion_label pred obs     P     N
## 14        14        massM   NC   C 0.412 0.588
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 84        84     nonmassM    C   C 0.854 0.146
##    lesion_id lesion_label pred obs     P     N
## 15        15     nonmassM   NC   C 0.456 0.544
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 109       109     nonmassM    C   C 0.804 0.196
##    lesion_id lesion_label pred obs    P    N
## 16        16     nonmassM   NC   C 0.42 0.58
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 202       202        massM    C   C 0.976 0.024
##    lesion_id lesion_label pred obs     P     N
## 17        17        massM    C   C 0.678 0.322
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs   P1   N1
## 85        85        massM    C   C 0.97 0.03
##    lesion_id lesion_label pred obs     P     N
## 18        18        massM    C   C 0.624 0.376
## [1] &quot;======&quot;
##   lesion_id lesion_label pred obs    P1    N1
## 6         6        massB   NC  NC 0.208 0.792
##    lesion_id lesion_label pred obs     P     N
## 19        19        massB    C   C 0.506 0.494
## [1] &quot;======&quot;
##   lesion_id lesion_label pred obs    P1    N1
## 6         6        massB   NC  NC 0.208 0.792
##    lesion_id lesion_label pred obs    P    N
## 20        20        massB   NC  NC 0.37 0.63
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 21        21        massB   NC  NC 0.108 0.892
##    lesion_id lesion_label pred obs     P     N
## 21        21        massB   NC  NC 0.484 0.516
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 30        30        massB   NC  NC 0.118 0.882
##    lesion_id lesion_label pred obs     P     N
## 22        22        massB   NC  NC 0.276 0.724
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 31        31        massB   NC  NC 0.054 0.946
##    lesion_id lesion_label pred obs     P     N
## 23        23        massB   NC  NC 0.198 0.802
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 50        50        massB   NC  NC 0.192 0.808
##    lesion_id lesion_label pred obs     P     N
## 24        24        massB   NC  NC 0.196 0.804
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 50        50        massB   NC  NC 0.192 0.808
##    lesion_id lesion_label pred obs     P     N
## 25        25        massB   NC  NC 0.474 0.526
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 50        50        massB   NC  NC 0.192 0.808
##    lesion_id lesion_label pred obs    P    N
## 26        26        massB    C  NC 0.58 0.42
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 132       132        massB   NC  NC 0.128 0.872
##    lesion_id lesion_label pred obs    P    N
## 27        27        massB    C  NC 0.58 0.42
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 144       144        massB   NC  NC 0.044 0.956
##    lesion_id lesion_label pred obs     P     N
## 28        28        massB   NC  NC 0.376 0.624
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 73        73        massB   NC  NC 0.138 0.862
##    lesion_id lesion_label pred obs     P     N
## 29        29        massB   NC  NC 0.468 0.532
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs   P1   N1
## 75        75        massB   NC  NC 0.17 0.83
##    lesion_id lesion_label pred obs    P    N
## 30        30        massB   NC  NC 0.47 0.53
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 83        83        massB   NC  NC 0.206 0.794
##    lesion_id lesion_label pred obs    P    N
## 31        31        massB   NC  NC 0.39 0.61
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 106       106        massB   NC  NC 0.232 0.768
##    lesion_id lesion_label pred obs     P     N
## 32        32        massB   NC  NC 0.392 0.608
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 132       132        massB   NC  NC 0.128 0.872
##    lesion_id lesion_label pred obs    P    N
## 33        33        massB    C  NC 0.51 0.49
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs   P1   N1
## 137       137        massB   NC  NC 0.07 0.93
##    lesion_id lesion_label pred obs     P     N
## 34        34        massB   NC  NC 0.346 0.654
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 144       144        massB   NC  NC 0.044 0.956
##    lesion_id lesion_label pred obs     P     N
## 35        35        massB   NC  NC 0.192 0.808
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 49        49     nonmassB   NC  NC 0.086 0.914
##    lesion_id lesion_label pred obs     P     N
## 36        36     nonmassB   NC  NC 0.238 0.762
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 79        79     nonmassB   NC  NC 0.072 0.928
##    lesion_id lesion_label pred obs    P    N
## 37        37     nonmassB   NC  NC 0.33 0.67
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs    P1    N1
## 105       105     nonmassB   NC  NC 0.134 0.866
##    lesion_id lesion_label pred obs     P     N
## 38        38     nonmassB   NC  NC 0.224 0.776
## [1] &quot;======&quot;
##     lesion_id lesion_label pred obs   P1   N1
## 137       137        massB   NC  NC 0.07 0.93
##    lesion_id lesion_label pred obs     P     N
## 39        39     nonmassB   NC  NC 0.358 0.642
## [1] &quot;======&quot;
##    lesion_id lesion_label pred obs    P1    N1
## 38        38        massM    C   C 0.832 0.168
##    lesion_id lesion_label pred obs     P     N
## 40        40        massM   NC  NC 0.268 0.732
## [1] &quot;======&quot;
</code></pre>

<pre><code class="r">
</code></pre>

</body>

</html>

